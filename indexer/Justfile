set fallback

import '../tools/lib/utils.justfile'

# Default: show available recipes
default:
    just --list

build-rc:
    docker build -f Dockerfile -t indexer:rc ..

build-dev:
    docker build -f Dockerfile.dev -t indexer:dev ..

publish-rc registry version:
    docker tag indexer:rc {{registry}}/chainlink-ccv-indexer:{{version}}-rc
    docker push {{registry}}/chainlink-ccv-indexer:{{version}}-rc

clean:
    docker rmi indexer:latest

clean-dev:
    docker rmi indexer:dev

create-migration name:
    goose create {{name}} sql -dir ./migrations

codegen:
    rm -f indexer_openapi_v1.yaml
    rm -f pkg/client/client.go
    cd cmd/oapigen && go run generator.go ../../indexer_opanapi_v1.yaml
    oapi-codegen -config client-codegen.yaml indexer_opanapi_v1.yaml
